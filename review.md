# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

XSSとは、攻撃者がウェブアプリケーションに悪意のあるスクリプトを挿入し、それが他のユーザーのブラウザで実行される攻撃。
攻撃者は個人情報の窃取やフィッシング、ウェブサイトの改ざんを行うことができる。

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。

htmlspecialchars()をe()として定義しなおすメリットは、コードの可読性が向上し一貫性が保たれ、入力ミスが減り意図が明確になる。

### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。

htmlspecialchars()を使用すると、HTML内で特別な意味を持つ文字を別の文字列に変換することにより、攻撃者が入力した悪意のあるコードを単なるテキストとして表示し、スクリプトを実行するのを防ぐ。

## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

攻撃者がユーザーに認証済みのウェブサイトに対して意図しないリクエスト送信をさせる攻撃。
攻撃者はユーザーの権限を悪用して不正な操作を実行したり、ユーザーの身に覚えのない取引やデータの改ざんを行うことができる。

### SessionとCookieの違いを説明してください。

Sessionはデータを一時的に保存するサーバ側の領域のことで、Cookieはデータを一時的に保存するブラウザ側の領域のことである。
後者はクライアントが側で直接アクセスできるが前者はアクセスできない。

### `setToken()`が何をしているか説明してください。

16バイトのランダムなトークンを生成し、それをセッション変数$_SESSION['token']に保存している。
これによりセッション内で生成したトークンが利用可能になる。

### `checkToken()`が何をしているか説明してください。

checkToken()は、渡されたトークンが現在のセッションに保存されているトークンと一致するかどうかを確認する。
トークンが設定されていなかったり、渡されたトークンと一致しなかった場合、エラーメッセージを設定し元のページにリダイレクトする。

### トークンを使うことでなぜCSRFが防げるのか説明してください。

トークンを使用することにより、サーバーがリクエストに含まれるトークンとセッション内のトークンを比較し、一致しないリクエストを拒否することができる。これにより不正なリクエストを防止できるから。

## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

SQLインジェクションは、攻撃者がSQLクエリに悪意のあるコードを挿入して、データベースに不正な操作を行わせる攻撃。
攻撃者はデータの窃取、改竄、認証バイパス、さらにはシステム全体の侵害が可能になる。

### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。

->prepare()は、SQLクエリを準備し、PDOStatementオブジェクトを返す。このメソッドはクエリを実行する前に構文チェックを行い、パラメータバインディングの準備を行う。

### `->bindValue()`が何をしているか説明してください。

->bindValue()は、SQLクエリ内のプレースホルダに指定した値をバインドするメソッドで、クエリが実行される際にプレースホルダが指定した値で置き換えられる。

### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。

上記のメソッドを追記することで、SQLクエリとユーザーからの入力を分離できる。その結果、ユーザーの入力がSQLクエリに直接影響を与えず、悪意のあるコードが実行されるリスクがなくなるから。

## バリデーション

### バリデーションの目的について説明してください。

バリデーションの目的は、データが正しい形式や条件に合っているかを確認し、エラーやセキュリティリスクを減らし、ユーザーに対して正しい情報を提供することである。

### `validate()`が何をしているか説明してください。

validate()は、$post配列の'content'キーが存在し、かつ空であるかを確認し、空であればエラーメッセージを設定して、ユーザーを元のページにリダイレクトする。

### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。

isset($post['content'])は、$post配列に'content'キーが存在するかを確認するために必要。無い場合、未定義のキーにアクセスしてエラーが発生する。

## その他

### `unsetError()`を実行しないとどうなるか説明してください。

unsetError()を実行しないと、以前のエラーメッセージがセッションに残り、新しいエラーメッセージが正しく表示されない。これにより、ユーザーが古いエラーメッセージに混乱したり、新しいエラー情報を見逃したりすることになる。